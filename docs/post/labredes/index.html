<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme" content="hugo-academic">
  <meta name="generator" content="Hugo 0.37.1" />
  <meta name="author" content="L√©o Lima">
  <meta name="description" content="Graduando em Ci√™ncia da Computa√ß√£o">

  
  <link rel="alternate" hreflang="en-us" href="https://tsleolima.github.io/portfolio-vis/post/labredes/">

  
  


  

  
  
  
  
    
  
  
    
    
      
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
      
    
  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.1/css/academicons.min.css" integrity="sha512-NThgw3XKQ1absAahW6to7Ey42uycrVvfNfyjqcFNgCmOCQ5AR4AO0SiXrN+8ZtYeappp56lk1WtvjVmEa+VR6A==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  
  
  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700%7cRoboto:400,400italic,700%7cRoboto&#43;Mono">
  
  <link rel="stylesheet" href="/portfolio-vis/styles.css">
  

  

  
  <link rel="alternate" href="https://tsleolima.github.io/portfolio-vis/index.xml" type="application/rss+xml" title="L√©o Lima">
  <link rel="feed" href="https://tsleolima.github.io/portfolio-vis/index.xml" type="application/rss+xml" title="L√©o Lima">
  

  <link rel="manifest" href="/portfolio-vis/site.webmanifest">
  <link rel="icon" type="image/png" href="/portfolio-vis/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/portfolio-vis/img/icon-192.png">

  <link rel="canonical" href="https://tsleolima.github.io/portfolio-vis/post/labredes/">

  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@xMiraxe">
  <meta property="twitter:creator" content="@xMiraxe">
  
  <meta property="og:site_name" content="L√©o Lima">
  <meta property="og:url" content="https://tsleolima.github.io/portfolio-vis/post/labredes/">
  <meta property="og:title" content="LabRedes | L√©o Lima">
  <meta property="og:description" content=""><meta property="og:image" content="https://tsleolima.github.io/img/headers/redes.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2018-03-12T21:48:58-03:00">
  
  <meta property="article:modified_time" content="2018-03-12T21:48:58-03:00">
  

  

  <title>LabRedes | L√©o Lima</title>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71" >

<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">

    
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
              data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Alterar navega√ß√£o</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
      <a class="navbar-brand" href="/portfolio-vis/">L√©o Lima</a>
    </div>

    
    <div class="collapse navbar-collapse">

      
      <ul class="nav navbar-nav navbar-right">
        

        

        <li class="nav-item">
          <a href="/portfolio-vis/#about">
            
            <span>Inicio</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/portfolio-vis/#posts">
            
            <span>Posts</span>
          </a>
        </li>

        
        

        

        <li class="nav-item">
          <a href="/portfolio-vis/#contact">
            
            <span>Contato</span>
          </a>
        </li>

        
        

        
      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  
<div class="article-header">
  <img src="/portfolio-vis/img/headers/redes.png" class="article-banner" itemprop="image">
  
</div>



  <div class="article-container">
    <div class="article-inner">
      <h1 itemprop="name">LabRedes</h1>

      

<div class="article-metadata">

  <span class="article-date">
    
    <time datetime="2018-03-12 21:48:58 -0300 -03" itemprop="datePublished">
      Mar 12, 2018
    </time>
  </span>

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    10 
  </span>
  

  
  

  
  
  
  

  
  
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=LabRedes&amp;url=https%3a%2f%2ftsleolima.github.io%2fportfolio-vis%2fpost%2flabredes%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=https%3a%2f%2ftsleolima.github.io%2fportfolio-vis%2fpost%2flabredes%2f"
         target="_blank" rel="noopener">
        <i class="fa fa-facebook"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2ftsleolima.github.io%2fportfolio-vis%2fpost%2flabredes%2f&amp;title=LabRedes"
         target="_blank" rel="noopener">
        <i class="fa fa-linkedin"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=https%3a%2f%2ftsleolima.github.io%2fportfolio-vis%2fpost%2flabredes%2f&amp;title=LabRedes"
         target="_blank" rel="noopener">
        <i class="fa fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=LabRedes&amp;body=https%3a%2f%2ftsleolima.github.io%2fportfolio-vis%2fpost%2flabredes%2f">
        <i class="fa fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>


      <div class="article-style" itemprop="articleBody">
        <p>Bem vindos novamente a outro post, espero que estejam aqui para aprender mais uma vez sobre algo relacionado a visualiza√ß√£o de dados usando nossa velha amiga D3, e bem, se voc√™ caiu de paraquedas aqui, meu caro amigo leitor, n√£o se intimide, continue lendo e brinque com a visualiza√ß√£o üòÑ.</p>

<p>Bem, a ideia √© trazer para voc√™s algum dado sobre o gr√°fico logo abaixo, mas vou fazer diferente hoje, dessa vez, vou dar as diretivas para voc√™s irem buscar como fazer a de voc√™s mesmos üòâ.</p>

<p>Como eu disse, para quem caiu aqui de paraquedas, aconselho estudar um pouco sobre javascript,d3,html, mas n√£o fique triste, a internet est√° ai aberta para conseguirmos aprender tudo isso, ent√£o, n√£o desistam üí™.</p>

<p>Assumindo que voc√™s camaradas, j√° possuem certos dominios em cria√ß√£o de visualiza√ß√µes atrav√©s da ferramenta &lsquo;D3&rsquo;, irei dar-lhes um exemplo de como √© representado um n√≥ e suas arestas,</p>

<p>Podemos representar um n√≥ dessa maneira:</p>

<pre><code>    var node_data = ['id1', 'id2', 'id3']; 
</code></pre>

<p>e nossas arestas dessa maneira:</p>

<pre><code>    var edge_data = [
        {source: 'id1', target:'id2', weight: 10.0},
        {source: 'id2', target:'id3', weight: 20.0}, 
        {source: 'id3', target:'id1', weight: 30.0}
    ];
</code></pre>

<p>Por motivos de hora, n√£o posso explicar detalhadamente, entretanto, √© aconselhavel seguir esse padr√£o, para irmos at√© o proximo passo.</p>

<p>Bem, um dos meus maiores desejos desde o dia em que me foi apresentado esse tipo de visualiza√ß√£o, era a de detectar clusters ou agrupamentos de n√≥s e separa-los por cores, afim de descobrir alguma informa√ß√£o atrav√©s dessa visualiza√ß√£o, mas nossos amigos que trabalham com Grafos em si, j√° descobriram isso para n√≥s, e podemos usar algoritmos que realizam essas opera√ß√µes para conseguirmos extrair essas informa√ß√µes ou at√© mesmo aproveitar a vista, como est√£o fazendo os que cairam de paraquedas aqui üòÅ.
Buscando na internet com meu professor, descobrimos que existe um script j√° desenvolvido para isso, chamado jLouvain, e essas formas de representa√ß√£o de n√≥s e arestas estavam no git dos responsaveis a qual deixarei logo abaixo, mas vou dizer para voc√™s, n√£o foi facil associar a API do Spotify com os artistas semelhantes ao Nando Reis ( escolhi por ser muito f√£, e por outros motivos que supostamente voc·∫Ωs devem desconfiar üíú, sim, √© amor üòå)
Ent√£o deixarei aqui, apenas o link da API do Spotify.</p>

<pre><code>    https://developer.spotify.com/web-api/get-related-artists/
</code></pre>

<p>L√° voc√™s encontraram detalhadamente pela pr√≥pria equipe do Spotify, como usar esses dados, lembrando que essas dados s√£o em redes, visto que temos indica√ß√µes do Spotify quando estamos procurando algum artista, ent√£o, √© sugerido que o sistema nos indique artistas com sons semelhante ao qual nos estamos escutando, n√£o √© verdade ? üëç</p>

<p>Bem, as dificuldades que senti ao formar esses clusters mesmo usando o script do jLouvain</p>

<pre><code>    https://github.com/upphiminn/jLouvain
</code></pre>

<p>Foi em como o json recebido pela api do spotify tinha inumeras informa√ß√µes a mais, e tanta informa√ß√£o assim, as vezes, deixa voc√™ meio L√©l√© da cuca, ent√£o busquei por projetos no</p>

<pre><code>    https://bl.ocks.org/
</code></pre>

<p>Aconselho a todos irem l√° e desfrutarem de tantas cria√ß√µes legais e divertidas, que podemos usar em inumeros dados, da forma como quisermos, al√©m de ter todo o codigo aberto para entendermos a ideia.</p>

<p>O fato √© que nessas pesquisas, encontrei esse link:</p>

<pre><code>    https://bl.ocks.org/micahstubbs/3f439df92579c5bb2902fab15742ba87
</code></pre>

<p>Foi aqui que minha dor de cabe√ßa passou, mas eu primeiro tive que entender como era necessario passar o json para o nosso amigo script jLouvain, e foi ai que as ideias viram, mas para n√£o dar rodeios e ir direto ao ponto, voces precisam atentar para as linhas do &lsquo;vis.js&rsquo;, onde se diz</p>

<pre><code>    var nodeData = nodes.map(function (d) {return d.id});
    var linkData = links.map(function (d) {return {source: d.source, target: d.target,      weight: d.weight}; });
</code></pre>

<p>isso era oque eu precisava, usar os dados que foram carregados, e filtra-los para usar apenas os dados em que o jLouvain ir√° utilizar, exatamente aqui;</p>

<pre><code>    var community = jLouvain()
        .nodes(nodeData)
        .edges(linkData);

    var result  = community();
</code></pre>

<p>Mas, n√£o precisamos usar os dados filtrados na nossa visualiza√ß√£o, pois l√° possuem varios dados importantissimos para a leitura da mesma, como o Label, ent√£o usamos outra variavel para dessa forma, criar os circulos referentes aos n√≥s, e os links referentes as arestas da nossa visualiza√ß√£o, deixarei aqui a mudan√ßa que fiz para que os label fossem usados na nossa visualiza√ß√£o e pudessemos identificar quais artistas pertences aos clusters formados, clusters esses que se afastam um dos outros, √© lindo de se ver.</p>

<pre><code>    circles.append(&quot;title&quot;)
        .text(function (d) { return d.label; });
</code></pre>

<p>Bem, sei que voc√™s querem ver como ficou, ent√£o aqui est√°:</p>

<div id="chart"></div>

<p>Espero que tenham gostado, depois eu passo aqui e coloco mais alguma coisinha nova pra voc√™s, fiquem bem, se alimentem, e nunca esque√ßam de seus caf√©s, Certo ???</p>

<p>Abs: L√©o. üòå</p>

<script src='//d3js.org/d3.v4.min.js'></script>

<script>
    /* global d3 */

d3.json('https://raw.githubusercontent.com/tsleolima/lab-redes/master/artistasSemelhantesNandoReis.json', (error, graph) => {
    if (error) throw error;
    const nodes = graph.nodes;
    const links = graph.edges;

    const width = 1000;
    const height = 1000;

    // separation between same-color circles
    const padding = 9; // 1.5

    // separation between different-color circles
    const clusterPadding = 48; // 6

    const maxRadius = 12;

    const z = d3.scaleOrdinal(d3.schemeCategory20);

    // total number of nodes
    const n = nodes.length;

    // detect communities with jsLouvain
    var nodeData = nodes.map(function (d) { return d.id });
    var linkData = links.map(function (d) { return { source: d.source, target: d.target }; });

    var community = jLouvain()
        .nodes(nodeData)
        .edges(linkData);

    var result = community();

    const defaultRadius = 8;
    nodes.forEach(function (node) {
        node.r = defaultRadius;
        node.cluster = result[node.id]
    });

    // collect clusters from nodes
    const clusters = {};
    nodes.forEach((node) => {
        const radius = node.r;
        const clusterID = node.cluster;
        if (!clusters[clusterID] || (radius > clusters[clusterID].r)) {
            clusters[clusterID] = node;
        }
    });

    var svg = d3.select("#chart")
    .append("svg")
    .attr('version', '1.1')
    .attr('viewBox', '0 0 ' + width + ' ' + height)
    .attr('width', '100%');

    let link = svg.selectAll('line')
        .data(graph.edges)
        .enter().append('line');

    link
        .attr('class', 'link')
        .style('stroke', 'darkgray')
        .style('stroke-width', '0.2px');

    const circles = svg.append('g')
        .datum(nodes)
        .selectAll('.circle')
        .data(d => d)
        .enter().append('circle')
        .attr('r', d => d.r)
        .attr('fill', d => z(d.cluster))
        .attr('stroke', 'black')
        .attr('stroke-width', 1)
        .call(d3.drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended)
        );

    circles.append("title")
        .text(function (d) { return d.label; });

    const simulation = d3.forceSimulation()
        .nodes(nodes)
        .force('link', d3.forceLink().id(d => d.id))
        .force("charge", d3.forceManyBody())
        .force("center", d3.forceCenter(width / 2, height / 2))
        // .velocityDecay(0.2)
        .force('x', d3.forceX().strength(0.0005))
        .force('y', d3.forceY().strength(0.0005))
        .force('collide', collide)
        .force('cluster', clustering)
        .on('tick', ticked);

    simulation.force('link')
        .links(graph.edges)
        // .distance([85]);

    function ticked() {
        link
            .attr('x1', d => d.source.x)
            .attr('y1', d => d.source.y)
            .attr('x2', d => d.target.x)
            .attr('y2', d => d.target.y);

        circles
            .attr('cx', d => d.x)
            .attr('cy', d => d.y);
    }

    function dragstarted(d) {
        if (!d3.event.active) simulation.alphaTarget(0.3).restart();
        d.fx = d.x;
        d.fy = d.y;
    }

    function dragged(d) {
        d.fx = d3.event.x;
        d.fy = d3.event.y;
    }

    function dragended(d) {
        if (!d3.event.active) simulation.alphaTarget(0);
        d.fx = null;
        d.fy = null;
    }

    // These are implementations of the custom forces
    function clustering(alpha) {
        nodes.forEach((d) => {
            const cluster = clusters[d.cluster];
            if (cluster === d) return;
            let x = d.x - cluster.x;
            let y = d.y - cluster.y;
            let l = Math.sqrt((x * x) + (y * y));
            const r = d.r + cluster.r;
            if (l !== r) {
                l = ((l - r) / l) * alpha;
                d.x -= x *= l;
                d.y -= y *= l;
                cluster.x += x;
                cluster.y += y;
            }
        });
    }

    function collide(alpha) {
        const quadtree = d3.quadtree()
            .x(d => d.x)
            .y(d => d.y)
            .addAll(nodes);

        nodes.forEach((d) => {
            const r = d.r + maxRadius + Math.max(padding, clusterPadding);
            const nx1 = d.x - r;
            const nx2 = d.x + r;
            const ny1 = d.y - r;
            const ny2 = d.y + r;
            quadtree.visit((quad, x1, y1, x2, y2) => {
                if (quad.data && (quad.data !== d)) {
                    let x = d.x - quad.data.x;
                    let y = d.y - quad.data.y;
                    let l = Math.sqrt((x * x) + (y * y));
                    const r = d.r + quad.data.r + (d.cluster === quad.data.cluster ? padding : clusterPadding);
                    if (l < r) {
                        l = ((l - r) / l) * alpha;
                        d.x -= x *= l;
                        d.y -= y *= l;
                        quad.data.x += x;
                        quad.data.y += y;
                    }
                }
                return x1 > nx2 || x2 < nx1 || y1 > ny2 || y2 < ny1;
            });
        });
    }
    

});
</script>

<script>
    /*
Author: Corneliu S. (github.com/upphiminn)

This is a javascript implementation of the Louvain
community detection algorithm (http://arxiv.org/abs/0803.0476)
Based on https://bitbucket.org/taynaud/python-louvain/overview

*/
(function(){
    jLouvain = function(){
        //Constants
        var __PASS_MAX = -1
        var __MIN    = 0.0000001

        //Local vars
        var original_graph_nodes;
        var original_graph_edges;
        var original_graph = {};
        var partition_init;

        //Helpers
        function make_set(array){
            var set = {};
            array.forEach(function(d,i){
                set[d] = true;
            });
            return Object.keys(set);
        };

        function obj_values(obj){
             var vals = [];
             for( var key in obj ) {
                 if ( obj.hasOwnProperty(key) ) {
                     vals.push(obj[key]);
                 }
             }
             return vals;
        };

        function get_degree_for_node(graph, node){
            var neighbours = graph._assoc_mat[node] ? Object.keys(graph._assoc_mat[node]) : [];
            var weight = 0;
            neighbours.forEach(function(neighbour,i){
                var value = graph._assoc_mat[node][neighbour] || 1;
                if(node == neighbour)
                    value *= 2;
                weight += value;
            });
            return weight;
        };

        function get_neighbours_of_node(graph, node){
            if(typeof graph._assoc_mat[node] == 'undefined')
                return [];

            var neighbours = Object.keys(graph._assoc_mat[node]);
            return neighbours;
        }

        function get_edge_weight(graph, node1, node2){
            return graph._assoc_mat[node1] ? graph._assoc_mat[node1][node2] : undefined;
        }

        function get_graph_size(graph){
            var size = 0;
            graph.edges.forEach(function(edge){
                size += edge.weight;
            });
            return size;
        }

        function add_edge_to_graph(graph, edge){
            update_assoc_mat(graph, edge);

            var edge_index = graph.edges.map(function(d){
                return d.source+'_'+d.target;
            }).indexOf(edge.source+'_'+edge.target);

            if(edge_index != -1)
                graph.edges[edge_index].weight = edge.weight;
            else
                graph.edges.push(edge);
        }

        function make_assoc_mat(edge_list){
            var mat = {};
            edge_list.forEach(function(edge, i){
                mat[edge.source] = mat[edge.source] || {};
                mat[edge.source][edge.target] = edge.weight;
                mat[edge.target] = mat[edge.target] || {};
                mat[edge.target][edge.source] = edge.weight;
            });

            return mat;
        }

        function update_assoc_mat(graph, edge){
            graph._assoc_mat[edge.source] = graph._assoc_mat[edge.source] || {};
            graph._assoc_mat[edge.source][edge.target] = edge.weight;
            graph._assoc_mat[edge.target] = graph._assoc_mat[edge.target] || {};
            graph._assoc_mat[edge.target][edge.source] = edge.weight;
        }

        function clone(obj){
            if(obj == null || typeof(obj) != 'object')
                return obj;

            var temp = obj.constructor();

            for(var key in obj)
                temp[key] = clone(obj[key]);
            return temp;
        }

        //Core-Algorithm Related
        function init_status(graph, status, part){
            status['nodes_to_com'] = {};
            status['total_weight'] = 0;
            status['internals'] = {};
            status['degrees'] = {};
            status['gdegrees'] = {};
            status['loops'] = {};
            status['total_weight'] = get_graph_size(graph);

            if(typeof part == 'undefined'){
                graph.nodes.forEach(function(node,i){
                    status.nodes_to_com[node] = i;
                    var deg = get_degree_for_node(graph, node);
                    if (deg < 0)
                        throw 'Bad graph type, use positive weights!';
                    status.degrees[i] = deg;
                    status.gdegrees[node] = deg;
                    status.loops[node] = get_edge_weight(graph, node, node) || 0;
                    status.internals[i] = status.loops[node];
                });
            }else{
                graph.nodes.forEach(function(node,i){
                    var com = part[node];
                    status.nodes_to_com[node] = com;
                    var deg = get_degree_for_node(graph, node);
                    status.degrees[com] = (status.degrees[com] || 0) + deg;
                    status.gdegrees[node] = deg;
                    var inc = 0.0;

                    var neighbours  = get_neighbours_of_node(graph, node);
                    neighbours.forEach(function(neighbour, i){
                        var weight = graph._assoc_mat[node][neighbour];
                        if (weight <= 0){
                            throw "Bad graph type, use positive weights";
                        }

                        if(part[neighbour] == com){
                            if (neighbour == node){
                                inc += weight;
                            }else{
                                inc += weight/2.0;
                            }
                        }
                    });
                    status.internals[com] = (status.internals[com] || 0) + inc;
                });
            }
        }

        function __modularity(status){
            var links = status.total_weight;
            var result = 0.0;
            var communities = make_set(obj_values(status.nodes_to_com));

            communities.forEach(function(com,i){
                var in_degree = status.internals[com] || 0 ;
                var degree = status.degrees[com] || 0 ;
                if(links > 0){
                    result = result + in_degree / links - Math.pow((degree / (2.0*links)), 2);
                }
            });
            return result;
        }

        function __neighcom(node, graph, status){
            // compute the communities in the neighb. of the node, with the graph given by
            // node_to_com

            var weights = {};
            var neighboorhood = get_neighbours_of_node(graph, node);//make iterable;

            neighboorhood.forEach(function(neighbour, i){
                if(neighbour != node){
                    var weight = graph._assoc_mat[node][neighbour] || 1; 
                    var neighbourcom = status.nodes_to_com[neighbour];
                    weights[neighbourcom] = (weights[neighbourcom] || 0) + weight;
                }   
            });

            return weights;
        }

        function __insert(node, com, weight, status){
            //insert node into com and modify status
            status.nodes_to_com[node] = +com;
            status.degrees[com] = (status.degrees[com] || 0) + (status.gdegrees[node]||0);
            status.internals[com] = (status.internals[com] || 0) + weight + (status.loops[node]||0);
        }

        function __remove(node, com, weight, status){
            //remove node from com and modify status
            status.degrees[com] = ((status.degrees[com] || 0) - (status.gdegrees[node] || 0));
            status.internals[com] = ((status.internals[com] || 0) - weight -(status.loops[node] ||0));
            status.nodes_to_com[node] = -1;
        }

        function __renumber(dict){
            var count = 0;
            var ret = clone(dict); //deep copy :)
            var new_values = {};
            var dict_keys = Object.keys(dict);
            dict_keys.forEach(function(key){
                var value = dict[key];
                var new_value =  typeof new_values[value] =='undefined' ? -1 : new_values[value];
                if(new_value == -1){
                    new_values[value] = count;
                    new_value = count;
                    count = count + 1;
                }
                ret[key] = new_value;
            });
            return ret;
        }

        function __one_level(graph, status){
            //Compute one level of the Communities Dendogram.
            var modif = true,
                nb_pass_done = 0,
                cur_mod = __modularity(status),
                new_mod = cur_mod;

            while (modif && nb_pass_done != __PASS_MAX){
                cur_mod = new_mod;
                modif = false;
                nb_pass_done += 1

                graph.nodes.forEach(function(node,i){
                    var com_node = status.nodes_to_com[node];
                    var degc_totw = (status.gdegrees[node] || 0) / (status.total_weight * 2.0);
                    var neigh_communities = __neighcom(node, graph, status);
                    __remove(node, com_node, (neigh_communities[com_node] || 0.0), status);
                    var best_com = com_node;
                    var best_increase = 0;
                    var neigh_communities_entries = Object.keys(neigh_communities);//make iterable;

                    neigh_communities_entries.forEach(function(com,i){
                        var incr = neigh_communities[com] - (status.degrees[com] || 0.0) * degc_totw;
                        if (incr > best_increase){
                            best_increase = incr;
                            best_com = com;
                        }
                    });

                    __insert(node, best_com, neigh_communities[best_com] || 0, status);

                    if(best_com != com_node)
                        modif = true;
                });
                new_mod = __modularity(status);
                if(new_mod - cur_mod < __MIN)
                    break;
            }
        }

        function induced_graph(partition, graph){
            var ret = {nodes:[], edges:[], _assoc_mat: {}};
            var w_prec, weight;
            //add nodes from partition values
            var partition_values = obj_values(partition);
            ret.nodes = ret.nodes.concat(make_set(partition_values)); //make set
            graph.edges.forEach(function(edge,i){
                weight = edge.weight || 1;
                var com1 = partition[edge.source];
                var com2 = partition[edge.target];
                w_prec = (get_edge_weight(ret, com1, com2) || 0); 
                var new_weight = (w_prec + weight);
                add_edge_to_graph(ret, {'source': com1, 'target': com2, 'weight': new_weight});
            });
            return ret;
        }

        function partition_at_level(dendogram, level){
            var partition = clone(dendogram[0]);
            for(var i = 1; i < level + 1; i++ )
                Object.keys(partition).forEach(function(key,j){
                    var node = key;
                    var com  = partition[key];
                    partition[node] = dendogram[i][com];
                });
            return partition;
        }


        function generate_dendogram(graph, part_init){

            if(graph.edges.length == 0){
                var part = {};
                graph.nodes.forEach(function(node,i){
                    part[node] = node;
                });
                return part;
            }
            var status = {};

            init_status(original_graph, status, part_init);
            var mod = __modularity(status);
            var status_list = [];
            __one_level(original_graph, status);
            var new_mod = __modularity(status);
            var partition = __renumber(status.nodes_to_com);
            status_list.push(partition);
            mod = new_mod;
            var current_graph = induced_graph(partition, original_graph);
            init_status(current_graph, status);

            while (true){
                __one_level(current_graph, status);
                new_mod = __modularity(status);
                if(new_mod - mod < __MIN)
                    break;

                partition = __renumber(status.nodes_to_com);
                status_list.push(partition); 

                mod = new_mod;
                current_graph = induced_graph(partition, current_graph);
                init_status(current_graph, status);
            }

            return status_list; 
        }

        var core = function(){
            var status = {};
            var dendogram = generate_dendogram(original_graph, partition_init);
            return partition_at_level(dendogram, dendogram.length - 1);
        };

        core.nodes = function(nds){
            if(arguments.length > 0){
                original_graph_nodes = nds;
            }
            return core;
        };

        core.edges = function(edgs){
            if(typeof original_graph_nodes == 'undefined')
                throw 'Please provide the graph nodes first!';

            if(arguments.length > 0){
                original_graph_edges = edgs;
                var assoc_mat = make_assoc_mat(edgs);
                original_graph = { 'nodes': original_graph_nodes,
                                   'edges': original_graph_edges,
                                   '_assoc_mat': assoc_mat };
            }
            return core;

        };

        core.partition_init = function(prttn){
            if(arguments.length > 0){
                partition_init = prttn;
            }
            return core;
        };

        return core;
    }
})();

</script>

      </div>

      




    </div>
  </div>

</article>






<div class="article-container">
  

</div>

<footer class="site-footer">
  <div class="container">
    <p class="powered-by">

      &copy; 2018 Leonardo Lima &middot; 

      Powered by the
      <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
      <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

      <span class="pull-right" aria-hidden="true">
        <a href="#" id="back_to_top">
          <span class="button_icon">
            <i class="fa fa-chevron-up fa-2x"></i>
          </span>
        </a>
      </span>

    </p>
  </div>
</footer>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close btn-large" data-dismiss="modal">&times;</button>
        <h4 class="modal-title"></h4>
      </div>
      <div>
        <pre><code class="modal-body tex"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-primary btn-outline js-copy-cite" href="#" target="_blank">
          <i class="fa fa-copy"></i> 
        </a>
        <a class="btn btn-primary btn-outline js-download-cite" href="#" target="_blank">
          <i class="fa fa-download"></i> 
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    

    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.3/imagesloaded.pkgd.min.js" integrity="sha512-umsR78NN0D23AzgoZ11K7raBD+R6hqKojyBZs1w8WvYlsI+QuKRGBx3LFCwhatzBunCjDuJpDHwxD13sLMbpRA==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
    
    
    
    <script src="/portfolio-vis/js/hugo-academic.js"></script>
    

    

    
    
      
      
      <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
      

      

      

      <script>hljs.initHighlightingOnLoad();</script>
    

    
    

  </body>
</html>

